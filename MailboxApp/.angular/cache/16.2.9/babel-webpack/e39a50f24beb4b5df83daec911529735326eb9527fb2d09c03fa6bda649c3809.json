{"ast":null,"code":"import _asyncToGenerator from \"D:/MailBox/FrontEnd/MailBox/MailboxApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as signalR from '@microsoft/signalr';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-toastr\";\nimport * as i2 from \"./user-context.service\";\nexport class SignalrService {\n  //#endregion \n  //#region --------------------   constructor\n  constructor(toastrService, userContextService) {\n    this.toastrService = toastrService;\n    this.userContextService = userContextService;\n    this.userID = this.userContextService.user$._value.id;\n    this.email = this.userContextService.user$._value.email;\n    this.hubConnection = new signalR.HubConnectionBuilder().withUrl('http://localhost:5261/mailHub', {\n      skipNegotiation: true,\n      transport: signalR.HttpTransportType.WebSockets\n    }).build();\n    this.startSignalRConnection();\n    this.hubConnection.on('Connected', connectionId => {\n      this.toastrService.success(connectionId);\n      //console.log('Connection ID:', connectionId);\n    });\n  }\n  //#endregion\n  //#region -------------------- Connections & Pages open/close \n  startSignalRConnection() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (_this.hubConnection.state === 'Disconnected') {\n        yield _this.hubConnection.start().then(() => {\n          console.log('SignalR connection started successfully.');\n          // Implement any logic you need after a successful connection\n        }).catch(error => {\n          console.error('Error starting SignalR connection:', error);\n          throw error; // Propagate the error\n        });\n      } else {\n        console.warn('SignalR connection is already in a connected or connecting state.');\n      }\n    })();\n  }\n  openNewPage() {\n    const brwserInfo = navigator.userAgent;\n    this.startSignalRConnection();\n    // console.log('User-Agent:', userAgent);\n    if (this.hubConnection.state === 'Connected') {\n      this.hubConnection.invoke('OpenNewPage', this.userID.toString(), this.email, brwserInfo.toString()).catch(error => {\n        console.error('Error JoinPrivateChat:', error);\n      });\n    } else {\n      console.error('SignalR connection is not in the \"Connected\" state.');\n    }\n  }\n  leavePage() {\n    const brwserInfo = navigator.userAgent;\n    // console.log('User-Agent:', userAgent);\n    this.hubConnection.invoke('LeavePage', this.userID.toString());\n  }\n  logOut() {\n    const brwserInfo = navigator.userAgent;\n    // console.log('User-Agent:', userAgent);\n    if (this.hubConnection.state === 'Connected') {\n      this.hubConnection.invoke('LeaveApplication', this.userID.toString(), brwserInfo.toString()).catch(error => {\n        console.error('Error JoinPrivateChat:', error);\n      });\n    } else {\n      console.error('SignalR connection is not in the \"Connected\" state.');\n    }\n  }\n  static #_ = this.ɵfac = function SignalrService_Factory(t) {\n    return new (t || SignalrService)(i0.ɵɵinject(i1.ToastrService), i0.ɵɵinject(i2.UserContextService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: SignalrService,\n    factory: SignalrService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["signalR","SignalrService","constructor","toastrService","userContextService","userID","user$","_value","id","email","hubConnection","HubConnectionBuilder","withUrl","skipNegotiation","transport","HttpTransportType","WebSockets","build","startSignalRConnection","on","connectionId","success","_this","_asyncToGenerator","state","start","then","console","log","catch","error","warn","openNewPage","brwserInfo","navigator","userAgent","invoke","toString","leavePage","logOut","_","i0","ɵɵinject","i1","ToastrService","i2","UserContextService","_2","factory","ɵfac","providedIn"],"sources":["D:\\MailBox\\FrontEnd\\MailBox\\MailboxApp\\src\\app\\common\\signalr.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport * as signalR from '@microsoft/signalr';\nimport { UserContextService } from './user-context.service';\nimport { ToastrService } from 'ngx-toastr';\n@Injectable({\n  providedIn: 'root'\n})\nexport class SignalrService {\n\n//#region ------------------- globle Var\n  private userID: any;\n  private email: any;\n  private hubConnection: signalR.HubConnection; \n//#endregion \n\n  //#region --------------------   constructor\n  constructor(\n    private toastrService: ToastrService,\n    private userContextService: UserContextService, )\n   {\n    this.userID = this.userContextService.user$._value.id;\n    this.email = this.userContextService.user$._value.email\n    ;\n    this.hubConnection = new signalR.HubConnectionBuilder()\n      .withUrl('http://localhost:5261/mailHub', {\n        skipNegotiation: true,\n        transport: signalR.HttpTransportType.WebSockets\n      }).build();\n   this.startSignalRConnection();\n   this.hubConnection.on('Connected', (connectionId: string) => {\n    this.toastrService.success(connectionId)\n\n    //console.log('Connection ID:', connectionId);\n  });\n   }\n   //#endregion\n\n  //#region -------------------- Connections & Pages open/close \n  async startSignalRConnection(): Promise<void> {\n\n    if (this.hubConnection.state === 'Disconnected') {\n      await this.hubConnection\n        .start()\n        .then(() => {\n          console.log('SignalR connection started successfully.');\n          // Implement any logic you need after a successful connection\n        })\n        .catch((error) => {\n          console.error('Error starting SignalR connection:', error);\n          throw error; // Propagate the error\n        });\n    } else {\n      console.warn('SignalR connection is already in a connected or connecting state.');\n    }\n  }\n   openNewPage(): void {\n   \n    const brwserInfo = navigator.userAgent;\n    this.startSignalRConnection();\n    // console.log('User-Agent:', userAgent);\n    if (this.hubConnection.state === 'Connected') {\n      this.hubConnection.invoke('OpenNewPage', this.userID.toString(), this.email ,brwserInfo.toString()).catch((error) => {\n        console.error('Error JoinPrivateChat:', error);\n      });\n    } else {\n      console.error('SignalR connection is not in the \"Connected\" state.');\n    }\n  }\n  leavePage(): void {\n   \n    const brwserInfo = navigator.userAgent;\n    // console.log('User-Agent:', userAgent);\n    this.hubConnection.invoke('LeavePage',this.userID.toString());\n  }\n  logOut(){\n    const brwserInfo = navigator.userAgent;\n    // console.log('User-Agent:', userAgent);\n    if (this.hubConnection.state === 'Connected') {\n      this.hubConnection.invoke('LeaveApplication', this.userID.toString(), brwserInfo.toString()).catch((error) => {\n        console.error('Error JoinPrivateChat:', error);\n      });\n    } else {\n      console.error('SignalR connection is not in the \"Connected\" state.');\n    }\n  }\n  //#endregion\n}\n"],"mappings":";AACA,OAAO,KAAKA,OAAO,MAAM,oBAAoB;;;;AAM7C,OAAM,MAAOC,cAAc;EAM3B;EAEE;EACAC,YACUC,aAA4B,EAC5BC,kBAAsC;IADtC,KAAAD,aAAa,GAAbA,aAAa;IACb,KAAAC,kBAAkB,GAAlBA,kBAAkB;IAE1B,IAAI,CAACC,MAAM,GAAG,IAAI,CAACD,kBAAkB,CAACE,KAAK,CAACC,MAAM,CAACC,EAAE;IACrD,IAAI,CAACC,KAAK,GAAG,IAAI,CAACL,kBAAkB,CAACE,KAAK,CAACC,MAAM,CAACE,KAAK;IAEvD,IAAI,CAACC,aAAa,GAAG,IAAIV,OAAO,CAACW,oBAAoB,EAAE,CACpDC,OAAO,CAAC,+BAA+B,EAAE;MACxCC,eAAe,EAAE,IAAI;MACrBC,SAAS,EAAEd,OAAO,CAACe,iBAAiB,CAACC;KACtC,CAAC,CAACC,KAAK,EAAE;IACb,IAAI,CAACC,sBAAsB,EAAE;IAC7B,IAAI,CAACR,aAAa,CAACS,EAAE,CAAC,WAAW,EAAGC,YAAoB,IAAI;MAC3D,IAAI,CAACjB,aAAa,CAACkB,OAAO,CAACD,YAAY,CAAC;MAExC;IACF,CAAC,CAAC;EACD;EACA;EAED;EACMF,sBAAsBA,CAAA;IAAA,IAAAI,KAAA;IAAA,OAAAC,iBAAA;MAE1B,IAAID,KAAI,CAACZ,aAAa,CAACc,KAAK,KAAK,cAAc,EAAE;QAC/C,MAAMF,KAAI,CAACZ,aAAa,CACrBe,KAAK,EAAE,CACPC,IAAI,CAAC,MAAK;UACTC,OAAO,CAACC,GAAG,CAAC,0CAA0C,CAAC;UACvD;QACF,CAAC,CAAC,CACDC,KAAK,CAAEC,KAAK,IAAI;UACfH,OAAO,CAACG,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;UAC1D,MAAMA,KAAK,CAAC,CAAC;QACf,CAAC,CAAC;OACL,MAAM;QACLH,OAAO,CAACI,IAAI,CAAC,mEAAmE,CAAC;;IAClF;EACH;EACCC,WAAWA,CAAA;IAEV,MAAMC,UAAU,GAAGC,SAAS,CAACC,SAAS;IACtC,IAAI,CAACjB,sBAAsB,EAAE;IAC7B;IACA,IAAI,IAAI,CAACR,aAAa,CAACc,KAAK,KAAK,WAAW,EAAE;MAC5C,IAAI,CAACd,aAAa,CAAC0B,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC/B,MAAM,CAACgC,QAAQ,EAAE,EAAE,IAAI,CAAC5B,KAAK,EAAEwB,UAAU,CAACI,QAAQ,EAAE,CAAC,CAACR,KAAK,CAAEC,KAAK,IAAI;QAClHH,OAAO,CAACG,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAChD,CAAC,CAAC;KACH,MAAM;MACLH,OAAO,CAACG,KAAK,CAAC,qDAAqD,CAAC;;EAExE;EACAQ,SAASA,CAAA;IAEP,MAAML,UAAU,GAAGC,SAAS,CAACC,SAAS;IACtC;IACA,IAAI,CAACzB,aAAa,CAAC0B,MAAM,CAAC,WAAW,EAAC,IAAI,CAAC/B,MAAM,CAACgC,QAAQ,EAAE,CAAC;EAC/D;EACAE,MAAMA,CAAA;IACJ,MAAMN,UAAU,GAAGC,SAAS,CAACC,SAAS;IACtC;IACA,IAAI,IAAI,CAACzB,aAAa,CAACc,KAAK,KAAK,WAAW,EAAE;MAC5C,IAAI,CAACd,aAAa,CAAC0B,MAAM,CAAC,kBAAkB,EAAE,IAAI,CAAC/B,MAAM,CAACgC,QAAQ,EAAE,EAAEJ,UAAU,CAACI,QAAQ,EAAE,CAAC,CAACR,KAAK,CAAEC,KAAK,IAAI;QAC3GH,OAAO,CAACG,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAChD,CAAC,CAAC;KACH,MAAM;MACLH,OAAO,CAACG,KAAK,CAAC,qDAAqD,CAAC;;EAExE;EAAC,QAAAU,CAAA,G;qBA7EUvC,cAAc,EAAAwC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,aAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,kBAAA;EAAA;EAAA,QAAAC,EAAA,G;WAAd9C,cAAc;IAAA+C,OAAA,EAAd/C,cAAc,CAAAgD,IAAA;IAAAC,UAAA,EAFb;EAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}